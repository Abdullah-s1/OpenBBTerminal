<html>

<head>
    <meta charset="utf-8">
    <meta name='color-scheme' content='dark'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/{{MAIN_PATH}}/web/css/style.css">

    <script src="/{{MAIN_PATH}}/web/helpers.js" type="text/javascript"></script>
    <script src="/{{MAIN_PATH}}/web/bar_menus.js" type="text/javascript"></script>
    <script src="/{{MAIN_PATH}}/web/popups.js" type="text/javascript"></script>
    <script src="/{{MAIN_PATH}}/web/main.js" type="text/javascript"></script>
    <script src="/{{MAIN_PATH}}/assets/plotly.js" type="text/javascript" ></script>
</head>

<body>
    <!-- Plotly -->
    <div id="openbb_chart" class="plotly-graph-div"></div>

    <!-- Popups Overlay -->
    <div id="popup_overlay" class="popup_overlay">
        <div id="popup_content" class="popup_content">

            <!-- CSV Popup -->
            <div id="popup_csv" class="popup_content">
                <input type="file" id="csv_file" accept=".csv, .txt"></input>

                <label for="csv_type">Choose a type</label>
                <select id="csv_type" value="scatter">
                    <option value="scatter">Scatter</option>
                    <option value="candlestick">Candlestick</option>
                </select>
                <br><br>

                <div id="csv_columns"><!-- Empty --></div>
                <div id="csv_colors"><!-- Empty --></div>

                <label for="csv_name">Name of trace</label>
                <input type="text" id="csv_name" value=""></input>

                <button id="csv_submit" onclick="on_submit('csv')">Submit</button>
                <button id="csv_cancel" onclick="closePopup()">Cancel</button>
            </div>

            <!-- Text Popup -->
            <div id="popup_text"></div>

            <!-- Title Popup -->
            <div id="popup_title"></div>

        </div>
    </div>

    <!-- Change Color Popup -->
    <div id="changecolor">
        <div id="changecolor_header">
            <input type="color" id="picked_color" value="#00ACFF"
                onchange="update_color()">
            </input>
        </div>
    </div>

    <!-- Plotly Chart -->
    <div>
        <script type="text/javascript">window.PlotlyConfig = { MathJaxConfig: 'local' };</script>
        <script type="text/javascript">
            var plotly_figure = "{{figure_json}}";

            var interval = setInterval(function() {
                if (typeof OpenBBMain != 'undefined') {
                    clearInterval(interval);
                    OpenBBMain(plotly_figure);
                }
            }, 200);

        </script>
    </div>

    <script>
        function log_to_div(text) {
            var div = document.getElementById("openbb_chart");
            div.innerHTML += text + '<br>';
        }
        function http_request(url, callback) {
            var xhrProto = XMLHttpRequest.prototype,
                origOpen = xhrProto.open;

            xhrProto.open = function (method, url) {
                this._url = url;
                return origOpen.apply(this, arguments);
            };

            var request = new XMLHttpRequest();
            request.open('GET', url, true);
            alert(request._url);

            request.onprogress = function() {
                log_to_div(`Loading ${request.responseURL}`);
            };

            request.onload = function() {
                log_to_div(`Loaded ${request.responseURL}`);
                if (request.status >= 200 && request.status < 400) {
                    var resp = request.responseText;
                    callback(resp);
                } else {
                    log_to_div("Error: " + request.responseText);
                    log_to_div("URL: " + request._url);
                }
            };

            request.onerror = function() {
                log_to_div("Error: " + request.responseText);
                log_to_div("URL: " + request._url);
            };

            request.send();
        }

        http_request("/{{MAIN_PATH}}/assets/plotly.js", function(resp) {
            log_to_div("Loaded plotly.js");
        });
        http_request("/{{MAIN_PATH}}/web/helpers.js", function(resp) {
            log_to_div("Loaded helpers.js");
        });


    </script>
</body>

</html>
